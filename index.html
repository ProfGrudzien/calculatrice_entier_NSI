<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>calculatrice NSI</title>
        <style>
            h1 {
                text-align: center;
            }
            h2 {
                text-align: center;
                font-style: italic;
                font-weight: normal;
            }
            div.calculatrice {
                height: 530px;
                width: 550px;
                border: 1px solid;
                margin: auto;
                background-color: #eee;
                cursor: default;
            }
            div.ecran {
                height: 80px;
                width: 450px;
                border: 1px solid;
                margin: 10px auto;
                background-color: skyblue;
                padding: 5px;
            }
            div.calcul {
                border: none;
                height: 20px;
                width: 100%;
                text-align: left;
                line-height: 20px;
                font-size: 16pt;
            }
            div.reponse{
                border: none;
                height: 60px;
                width: 100%;
                text-align: right;
                line-height: 60px;
                font-size: 32pt;
            }
            div.ligne {
                width: 535px;
                margin: auto;
                text-align: left;
            }
            div.touche {
                height: 80px;
                width: 80px;
                border: 1px solid;
                margin: 10px;
                display: inline-block;
                background-color: #ddd;
                text-align: center;
                line-height: 80px;
                font-size: 32pt;
            }
            div.invisible {
                border: none;
                background-color: #eee;
            }
            div.touche:hover {
                background-color: #bbb;
                cursor: pointer;
            }
            div.invisible:hover {
                background-color: #eee;
                cursor: default;
            }
        </style> 
    </head>

    <body>
        <h1>Calculatrice spéciale pour NSI</h1>
        <h2>Attention : cette calculatrice ne calcule qu'avec des nombres entiers !</h2>
        <div class="calculatrice">
            <div class="ecran">
                <div class="calcul"></div>
                <div class="reponse"></div>
            </div>
            <div class="clavier">
                <div class="ligne">
                    <div class= "touche">7</div>
                    <div class= "touche">8</div>
                    <div class= "touche">9</div>
                    <div class= "touche">(</div>
                    <div class= "touche">)</div>
                </div>
                <div class="ligne">
                    <div class= "touche">4</div>
                    <div class= "touche">5</div>
                    <div class= "touche">6</div>
                    <div class= "touche">+</div>
                    <div class= "touche">−</div>
                </div>
                <div class="ligne">
                    <div class= "touche">1</div>
                    <div class= "touche">2</div>
                    <div class= "touche">3</div>
                    <div class= "touche">×</div>
                    <div class= "touche">÷</div>
                </div>
                <div class="ligne">
                    <div class= "touche">C</div>
                    <div class= "touche">0</div>
                    <div class= "touche">←</div>
                    <div class= "touche">^</div>
                    <div class= "touche">=</div>
                </div>
            </div>
        </div>
        <script>
            var calculStr = ""
            var calculExp = ""
            const divCalcul = document.querySelector("div.calcul")
            const divReponse = document.querySelector("div.reponse")
            function calculer(expression) {
                const regExp = new RegExp("^[0-9]*÷[0-9]*$")
                if (expression.match(regExp)) {
                    const liste = expression.split("÷")
                    return `q = ${Math.floor(liste[0]/liste[1])} ; r = ${liste[0]%liste[1]}`
                } else if (expression.indexOf("÷") > -1) {
                    const newRegExp = /([0-9]+)÷([0-9]+)/gi
                    const newExpression = expression.replace(newRegExp, "Math.floor($1/$2)")
                    return eval(newExpression).toString()
                }
                try {
                    return eval(expression).toString()
                } catch (e) {
                    console.error(e)
                    return "erreur de syntaxe"
                }
            }
            function handleEvent(event) {
                if (event.target.className == "touche") {
                    const touche = event.target.textContent
                    if (touche == "=") {
                        divReponse.textContent = calculer(calculExp)
                        divCalcul.textContent = calculStr
                        calculStr = ""
                        calculExp = ""
                    } else if (touche == "C") {
                        divReponse.textContent = ""
                        divCalcul.textContent = ""
                        calculStr = ""
                        calculExp = ""
                    } else if (touche == "←") {
                        calculStr = calculStr.substr(0, calculStr.length - 1)
                        calculExp = calculStr.substr(0, calculExp.length - 1)
                        divReponse.textContent = calculStr
                        divCalcul.textContent = ""
                    } else {
                        if (touche == "×") {
                            calculExp += "*"
                        } else if (touche == "^") {
                            calculExp += "**"
                        } else if (touche == "−") {
                            calculExp += "-"
                        } else {
                            calculExp += touche
                        }
                    calculStr += touche
                    divReponse.textContent = calculStr
                    divCalcul.textContent = ""
                    }
                }
            }
            document.querySelector(".calculatrice").addEventListener("click", handleEvent)
        </script>
    </body>
</html>


